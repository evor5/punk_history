{% extends 'base.html' %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='articles.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="page-title">üì∞ –°—Ç–∞—Ç—å–∏ PRIME PUNK</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash-message">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    {% if current_user.is_authenticated %}
    <section class="article-create-section">
        <h2>–ù–æ–≤–∞—è —Å—Ç–∞—Ç—å—è</h2>
        <form method="POST" enctype="multipart/form-data" class="article-form">
            <input type="text" name="title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏" required class="input-text">
            <textarea name="content" placeholder="–¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏..." rows="6" required class="textarea"></textarea>
            
            <label class="file-upload">
                <span>‚ûï –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –º–µ–¥–∏–∞</span>
                <input type="file" name="media" style="display: none;">
            </label>

            <button type="submit" class="submit-button">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
        </form>
    </section>
    {% endif %}

    <section class="latest-articles">
        <h3 class="section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</h3>
        <div class="articles-grid">
            {% for article in articles %}
            <div class="article-card">
                <div class="article-image">
                    {% if article.media_filename %}
                        <img src="{{ url_for('static', filename='uploads/' ~ article.media_filename) }}" alt="{{ article.title }}">
                    {% else %}
                        <img src="https://i.imgur.com/default-punk.jpg" alt="–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é">
                    {% endif %}
                </div>
                <div class="article-content">
                    <h4 class="article-title">{{ article.title }}</h4>
                    <div class="article-meta">
                        <span class="article-date">{{ article.created_at.strftime('%d.%m.%Y') }}</span>
                        <span class="article-views">{{ article.views }} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</span>
                    </div>
                    <p class="article-excerpt">{{ article.content[:150] }}...</p>
                    <a href="{{ url_for('article_details', article_id=article.id) }}" class="read-more">–ß–∏—Ç–∞—Ç—å</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
</div>
{% endblock %}
